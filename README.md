# MCVE Vaadin Session

Here is a MCVE (Minimal Complete Verifiable Example) straight from the minimal example produced by start.vaadin.com
for an issue when accessing the Vaadin session from the Spring Security authSuccessHandler.

Originally I wanted to configure a dynamic route in an Authentication Sucess Handler (in de.hub28.SecurityConfiguration) 
for the currently logged in user, 
if he is in a certain role. (only for the current user => therefore session scope route). The call of

	RouteConfiguration.forSessionScope().setRoute(...)

always failed because there was supposedly no Vaadin session. 
However, the login view was already displayed beforehand, so a Vaadin session must exist. 
The de.hub28.security.ServiceInitListener in which the creation of the Vaadin session is logged serves as proof.

After activating the display of the current thread in the logback configuration (see application.yml / logging.pattern), 
you can see that the Vaadin session is created in a different thread than the one that handles the login request. 
This is IMO a problem. How can I access the Vaadin Session also from this context ?

As a workaround for my original problem, I derived a view from RouteNotFoundError and handled the error there. 
However, this only works if there is actually a route-not-found error beforehand, which is the case for me. 
It's not a general solution, as you may also want to define such a dynamic route under other circumstances.

## Running the application

The project is a standard Maven project. To run it from the command line,
type `mvnw` (Windows), or `./mvnw` (Mac & Linux), then open
http://localhost:8080 in your browser.

# reproducing the problem

1) login with user/user => login succesful, 
2) default route "" is shown; this is the about-user-view with @RolesAllowed("USER") 
3) logout
4) login with admin/admin => login succesful
5) default route should be shown but not possible due to wrong role (admin has role ADMIN)
6) dynamic route after authSuccess should re-route "" for the current user the about-admin-view

7) activate the workaround in NoRouteFoundView by removing the comments 
```
public class NoRouteFoundView { //extends RouteNotFoundError {

    //@Override

```
8) restart and now the admin gets his default route to about-admin-view
